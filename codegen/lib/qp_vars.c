/*
 * qp_vars.c
 *
 * Code generation for function 'qp_vars'
 *
 * C source code generated on: Fri Jun 27 17:20:59 2014
 *
 */

/* Include files */
#include "rt_nonfinite.h"
#include "kalman.h"
#include "kalman_4d.h"
#include "qp_vars.h"
#include "kron.h"
#include "eye.h"
#include "repmat.h"
#include "sum.h"
#include "all.h"

/* Function Definitions */
void qp_vars(const real_T x0[3], real_T H[100], real_T f[10], real_T A_ineq[6200],
             real_T b_ineq[620])
{
  int32_T all_safe;
  boolean_T a[8];
  int32_T i0;
  real_T u1;
  int32_T i1;
  static const int8_T b_a[24] = { 1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 1, 0, 0, -1, 1, -1 };

  static const real_T dv0[8] = { 10.0, 20.0, 5.0, 0.05, 0.0, 0.0,
    4.7794928335170894, -0.11025358324145534 };

  real_T dyn_A[9];
  static const real_T dv1[9] = { 0.93857190367167309, -0.096896144990943484, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.1, 1.0 };

  real_T dyn_B[3];
  real_T dyn_E[3];
  real_T dyn_K[3];
  int32_T i;
  static const real_T dv2[3] = { 0.010683147187535115, -0.000539800871140263,
    0.0 };

  static const real_T dv3[3] = { 0.0, 0.005000000000000001, 0.1 };

  static const real_T dv4[3] = { -0.0036803442061058471, 0.00018596140010782063,
    0.0 };

  real_T dyn_XUA[16];
  static const real_T dv5[16] = { 0.0, 0.0, 0.93857190367167309,
    -0.93857190367167309, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, -1.0,
    0.010683147187535115, -0.010683147187535115 };

  real_T dyn_XUb[4];
  real_T dyn_XD_plus[4];
  real_T dyn_XD_minus[4];
  static const real_T dv6[4] = { 10.0, 5.0, 10.003680344206106,
    0.046319655793894153 };

  static const real_T dv7[4] = { 0.0, 0.0, 0.0, 2.2050716648291067 };

  static const real_T dv8[4] = { 0.0, 0.0, 0.0, -1.1025358324145533 };

  boolean_T c_a[7];
  static const int8_T d_a[21] = { 1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, -1, 1 };

  static const real_T dv9[7] = { 10.0, 20.0, 5.0, 0.05, 0.0, 0.0,
    0.11025358324145534 };

  static const int8_T iv0[4] = { 0, 0, -10, 0 };

  static const int8_T e_a[21] = { 1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 1, 0, 0, -1, -1 };

  static const real_T dv10[7] = { 10.0, 20.0, 5.0, 0.05, 0.0, 0.0,
    -4.7794928335170894 };

  static const int8_T iv1[4] = { 0, 0, -10, 50 };

  real_T polyA[87];
  real_T polyb[29];
  boolean_T f_a[28];
  static const real_T g_a[84] = { -1.0, 0.0, 0.096325238060595564,
    0.74086783144419077, 0.67978232503087532, 0.7494721162457687,
    0.44610768781072568, 0.75721665764473689, 0.77053033419337369,
    0.4916576310880002, 0.642834010672428, 0.62039032895465362,
    0.70855368591335066, 0.72056655157227667, 0.69503938271554566,
    0.76420619659317834, 0.53103693046094169, 0.39345213237017,
    0.6624949152841938, 0.73128089686784026, 0.59467688988235123,
    0.56511744876353975, 0.33276122691839749, 0.26323368388773782,
    0.18438897262296844, 0.0, 1.0, 0.0, 0.0, 0.0, -0.99410805321097873,
    -0.670812851417677, -0.73249887649432854, -0.66120991416766051,
    -0.89386265988647273, -0.65234886050014973, -0.63660806585689955,
    -0.86970214398081358, -0.76504979038516163, -0.78331467816387124,
    -0.70477648898784206, -0.69252067301190745, -0.71807463297910279,
    -0.64416729994063371, -0.84629147186312259, -0.918198072467297,
    -0.74813182938386324, -0.681225425007739, -0.80296172251253861,
    -0.82398113257276606, -0.9418345582012837, -0.96352844276484562,
    -0.981627081664114, -1.0, 0.0, 0.0, 0.0, -1.0, -0.049705402660548931,
    -0.03354064257088385, -0.036624943824716427, -0.033060495708383014,
    -0.044693132994323648, -0.032617443025007485, -0.031830403292844985,
    -0.043485107199040689, -0.038252489519258082, -0.039165733908193577,
    -0.035238824449392095, -0.034626033650595363, -0.03590373164895512,
    -0.032208364997031662, -0.042314573593156143, -0.045909903623364841,
    -0.037406591469193146, -0.034061271250386958, -0.040148086125626932,
    -0.041199056628638306, -0.047091727910064177, -0.048176422138242261,
    -0.0490813540832057, 0.0, 0.0, 1.0 };

  static const real_T dv11[28] = { 0.05, 0.0, -0.19595364295110818,
    0.36187821497035721, 0.17483582599956837, 0.40030046016865906,
    -0.094924383463638851, 0.4390363829605084, 0.5174279150441965,
    -0.065067043299815719, 0.10280638203034087, 0.067579101600849345,
    0.24857853494485327, 0.28600586850589527, 0.21151321827582836,
    0.47808039710399886, -0.033557956590110738, -0.12262224445896308,
    0.13858296560988692, 0.3237768207039764, 0.033003879496105615,
    -0.00077531489457327574, -0.14749533924767877, -0.1687020528714045,
    -0.18523075139242029, -0.2, 3.1, 5.0 };

  static const real_T dv12[84] = { -1.0, 0.0, 0.096325238060595564,
    0.74086783144419077, 0.67978232503087532, 0.7494721162457687,
    0.44610768781072568, 0.75721665764473689, 0.77053033419337369,
    0.4916576310880002, 0.642834010672428, 0.62039032895465362,
    0.70855368591335066, 0.72056655157227667, 0.69503938271554566,
    0.76420619659317834, 0.53103693046094169, 0.39345213237017,
    0.6624949152841938, 0.73128089686784026, 0.59467688988235123,
    0.56511744876353975, 0.33276122691839749, 0.26323368388773782,
    0.18438897262296844, 0.0, 1.0, 0.0, 0.0, 0.0, -0.99410805321097873,
    -0.670812851417677, -0.73249887649432854, -0.66120991416766051,
    -0.89386265988647273, -0.65234886050014973, -0.63660806585689955,
    -0.86970214398081358, -0.76504979038516163, -0.78331467816387124,
    -0.70477648898784206, -0.69252067301190745, -0.71807463297910279,
    -0.64416729994063371, -0.84629147186312259, -0.918198072467297,
    -0.74813182938386324, -0.681225425007739, -0.80296172251253861,
    -0.82398113257276606, -0.9418345582012837, -0.96352844276484562,
    -0.981627081664114, -1.0, 0.0, 0.0, 0.0, -1.0, -0.049705402660548931,
    -0.03354064257088385, -0.036624943824716427, -0.033060495708383014,
    -0.044693132994323648, -0.032617443025007485, -0.031830403292844985,
    -0.043485107199040689, -0.038252489519258082, -0.039165733908193577,
    -0.035238824449392095, -0.034626033650595363, -0.03590373164895512,
    -0.032208364997031662, -0.042314573593156143, -0.045909903623364841,
    -0.037406591469193146, -0.034061271250386958, -0.040148086125626932,
    -0.041199056628638306, -0.047091727910064177, -0.048176422138242261,
    -0.0490813540832057, 0.0, 0.0, 1.0 };

  boolean_T h_a[29];
  static const real_T i_a[87] = { -1.0, 0.0, 0.049166683329717596,
    0.095970234669744428, 0.26082337052523052, 0.32984816446603654,
    0.3901763546298217, 0.59087941233739472, 0.61661840674144064,
    0.73755633656561226, 0.6761640170621479, 0.4425854872680936,
    0.56131925066004185, 0.767426463107833, 0.70506023663395712,
    0.72791069761973548, 0.71713548599524257, 0.63910420970681214,
    0.65881776600407138, 0.52727397287817268, 0.77320691860767221,
    0.76105471361788435, 0.48798048979635356, 0.75401467876760053,
    0.69148302596396571, 0.74621676803100645, 0.18263749116257208, 1.0, 0.0, 0.0,
    0.0, -0.993833779580869, -0.99044430176984233, -0.95470584283594584,
    -0.93358953845171722, -0.91055339968613813, -0.79783418323435318,
    -0.77855218929741743, -0.66781448487013229, -0.72859997176510838,
    -0.88680525282599076, -0.81844309161879547, -0.63404366406666546,
    -0.70130166277984018, -0.67808591264664164, -0.68922315130850453,
    -0.76061087862948484, -0.74397935612801125, -0.84029460285343616,
    -0.62713776091540974, -0.64151084113664325, -0.86319758173495065,
    -0.64959032732373678, -0.71440041014707267, -0.65833793472104563,
    -0.97230276248113756, 0.0, 0.0, 0.0, 1.0, -0.09938337795808691,
    -0.099044430176984236, -0.1432058764253919, -0.1400384307677576,
    -0.13658300995292072, -0.11967512748515298, -0.11678282839461263,
    -0.10017217273051987, -0.10928999576476622, -0.1330207879238986,
    -0.12276646374281937, -0.0951065496099998, -0.105195249416976,
    -0.10171288689699624, -0.10338347269627568, -0.11409163179442273,
    -0.11159690341920168, -0.12604419042801546, -0.094070664137311452,
    -0.096226626170496488, -0.12947963726024264, -0.09743854909856052,
    -0.1071600615220609, -0.098750690208156841, -0.14584541437217063, 0.0, -1.0
  };

  static const real_T dv13[29] = { 0.05, 4.7794928335170894,
    -0.20173460795201548, -0.20069146412388594, -0.17768329747618994,
    -0.15649729291190884, -0.13164050179121922, 0.023996716131681861,
    0.058584409356058575, 0.35289781539502152, 0.16587214371798531,
    -0.10395226275737857, -0.0097937322961900719, 0.50835303936414289,
    0.23962084254861327, 0.3148085146697559, 0.27704508444887588,
    0.093823879439669078, 0.1296111278856209, -0.042584712114947632,
    0.54796520410353811, 0.46903597132722719, -0.074097465043878152,
    0.4300179003305471, 0.20255443324999312, 0.39130333490390146,
    -0.19419126036557932, 3.3637231924302116, -0.11025358324145529 };

  real_T minval;
  real_T b_dyn_A[9];
  static const int8_T iv2[3] = { 3, 0, 0 };

  real_T Rx[900];
  static const real_T dv14[100] = { 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    1.0 };

  real_T c_dyn_A[3];
  real_T rx[30];
  real_T Lx[90];
  real_T Lu[300];
  real_T Ld[300];
  real_T Lk[300];
  real_T AN[9];
  real_T ANB[3];
  real_T ANE[3];
  real_T ANK[3];
  int32_T tmp_size[2];
  real_T tmp_data[100];
  int32_T diag_mat_size[2];
  real_T diag_mat_data[300];
  int32_T loop_ub;
  real_T b_Lu[300];
  int32_T y;
  int32_T b_loop_ub;
  int32_T i2;
  int8_T b_tmp_data[30];
  real_T b_Lk[30];
  real_T dLU_x[972];
  static const real_T dv15[81] = { 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0 };

  real_T dLU_u[324];
  real_T dlU[36];
  static real_T diagA[8700];
  real_T diagb[290];
  real_T b_dLU_x[108];
  real_T c_dLU_x[324];
  real_T d_dLU_x[360];
  real_T dv16[360];
  real_T b_diagA[290];
  real_T c_diagA[870];
  real_T d_diagA[2900];
  real_T e_diagA[290];
  real_T f_diagA[870];
  real_T g_diagA[2900];
  real_T h_diagA[870];
  real_T i_diagA[870];
  static real_T HH[8060];
  real_T b_dlU[36];
  real_T b_diagb[290];
  real_T c_diagb[290];
  real_T b_dyn_XUb[620];
  real_T b_HH[620];
  static const real_T Ru[100] = { 1.1, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1,
    -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1,
    -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 2.1, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, -1.0, 1.1 };

  real_T b_Lx[30];
  real_T c_Lu[10];
  real_T dv17[10];

  /*  Horizon */
  all_safe = 1;
  for (i0 = 0; i0 < 8; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 3; i1++) {
      u1 += (real_T)b_a[i0 + (i1 << 3)] * x0[i1];
    }

    a[i0] = (u1 <= dv0[i0]);
  }

  if (all(a)) {
    memcpy(&dyn_A[0], &dv1[0], 9U * sizeof(real_T));
    for (i = 0; i < 3; i++) {
      dyn_B[i] = dv2[i];
      dyn_E[i] = dv3[i];
      dyn_K[i] = dv4[i];
    }

    memcpy(&dyn_XUA[0], &dv5[0], sizeof(real_T) << 4);
    for (i = 0; i < 4; i++) {
      dyn_XUb[i] = dv6[i];
      dyn_XD_plus[i] = dv7[i];
      dyn_XD_minus[i] = dv8[i];
    }
  } else {
    for (i0 = 0; i0 < 7; i0++) {
      u1 = 0.0;
      for (i1 = 0; i1 < 3; i1++) {
        u1 += (real_T)d_a[i0 + 7 * i1] * x0[i1];
      }

      c_a[i0] = (u1 <= dv9[i0]);
    }

    if (b_all(c_a)) {
      memcpy(&dyn_A[0], &dv1[0], 9U * sizeof(real_T));
      for (i = 0; i < 3; i++) {
        dyn_B[i] = dv2[i];
        dyn_E[i] = dv3[i];
        dyn_K[i] = dv4[i];
      }

      memcpy(&dyn_XUA[0], &dv5[0], sizeof(real_T) << 4);
      for (i = 0; i < 4; i++) {
        dyn_XUb[i] = dv6[i];
        dyn_XD_plus[i] = dv7[i];
        dyn_XD_minus[i] = iv0[i];
      }
    } else {
      for (i0 = 0; i0 < 7; i0++) {
        u1 = 0.0;
        for (i1 = 0; i1 < 3; i1++) {
          u1 += (real_T)e_a[i0 + 7 * i1] * x0[i1];
        }

        c_a[i0] = (u1 <= dv10[i0]);
      }

      if (b_all(c_a)) {
        memcpy(&dyn_A[0], &dv1[0], 9U * sizeof(real_T));
        for (i = 0; i < 3; i++) {
          dyn_B[i] = dv2[i];
          dyn_E[i] = dv3[i];
          dyn_K[i] = dv4[i];
        }

        memcpy(&dyn_XUA[0], &dv5[0], sizeof(real_T) << 4);
        for (i = 0; i < 4; i++) {
          dyn_XUb[i] = dv6[i];
          dyn_XD_plus[i] = iv1[i];
          dyn_XD_minus[i] = dv8[i];
        }
      } else {
        all_safe = 0;
        memcpy(&dyn_A[0], &dv1[0], 9U * sizeof(real_T));
        for (i = 0; i < 3; i++) {
          dyn_B[i] = dv2[i];
          dyn_E[i] = dv3[i];
          dyn_K[i] = dv4[i];
        }

        memcpy(&dyn_XUA[0], &dv5[0], sizeof(real_T) << 4);
        for (i = 0; i < 4; i++) {
          dyn_XUb[i] = dv6[i];
          dyn_XD_plus[i] = dv7[i];
          dyn_XD_minus[i] = dv8[i];
        }
      }
    }
  }

  /*  Space dimensions */
  memset(&polyA[0], 0, 87U * sizeof(real_T));
  memset(&polyb[0], 0, 29U * sizeof(real_T));
  for (i0 = 0; i0 < 28; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 3; i1++) {
      u1 += g_a[i0 + 28 * i1] * x0[i1];
    }

    f_a[i0] = (u1 <= dv11[i0]);
  }

  if (c_all(f_a)) {
    for (i0 = 0; i0 < 3; i0++) {
      memcpy(&polyA[29 * i0], &dv12[28 * i0], 28U * sizeof(real_T));
    }

    memcpy(&polyb[0], &dv11[0], 28U * sizeof(real_T));
  } else {
    for (i0 = 0; i0 < 29; i0++) {
      u1 = 0.0;
      for (i1 = 0; i1 < 3; i1++) {
        u1 += i_a[i0 + 29 * i1] * x0[i1];
      }

      h_a[i0] = (u1 <= dv13[i0]);
    }

    if (d_all(h_a)) {
      for (i0 = 0; i0 < 3; i0++) {
        memcpy(&polyA[29 * i0], &dv12[28 * i0], 28U * sizeof(real_T));
      }

      memcpy(&polyb[0], &dv11[0], 28U * sizeof(real_T));
    } else {
      /*  Outside of region, not good! */
      /*  Let polytope constraint be all zeros */
      all_safe = 0;
    }
  }

  /*  Create MPC weights */
  u1 = (0.5 + fabs(x0[0] - x0[2]) / 20.0) - 0.5;
  if ((1.0 <= u1) || rtIsNaN(u1)) {
    minval = 1.0;
  } else {
    minval = u1;
  }

  /*  u_weight = 3.; */
  /*  u_weight_jerk = 100; */
  for (i0 = 0; i0 < 3; i0++) {
    b_dyn_A[3 * i0] = iv2[i0];
  }

  b_dyn_A[1] = 0.0;
  if ((0.0 >= minval) || rtIsNaN(minval)) {
    u1 = 0.0;
  } else {
    u1 = minval;
  }

  b_dyn_A[4] = 1.0 - u1;
  b_dyn_A[7] = 0.0;
  for (i0 = 0; i0 < 3; i0++) {
    b_dyn_A[2 + 3 * i0] = 0.0;
  }

  kron(dv14, b_dyn_A, Rx);
  u1 = x0[2];
  if ((3.0 <= u1) || rtIsNaN(u1)) {
    u1 = 3.0;
  }

  c_dyn_A[0] = 3.0 * -u1;
  if ((0.0 >= minval) || rtIsNaN(minval)) {
    u1 = 0.0;
  } else {
    u1 = minval;
  }

  c_dyn_A[1] = (1.0 - u1) * -0.2;
  c_dyn_A[2] = 0.0;
  repmat(c_dyn_A, rx);

  /* %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */
  /* %% Create dynamics matrices %%% */
  /* %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */
  memset(&Lx[0], 0, 90U * sizeof(real_T));
  for (i0 = 0; i0 < 300; i0++) {
    Lu[i0] = 0.0;
    Ld[i0] = 0.0;
    Lk[i0] = 0.0;
  }

  memcpy(&AN[0], &dyn_A[0], 9U * sizeof(real_T));
  for (i = 0; i < 3; i++) {
    ANB[i] = dyn_B[i];
    ANE[i] = dyn_E[i];
    ANK[i] = dyn_K[i];
  }

  for (i = 0; i < 10; i++) {
    eye(11.0 - (1.0 + (real_T)i), tmp_data, tmp_size);
    b_kron(tmp_data, tmp_size, ANB, diag_mat_data, diag_mat_size);

    /*  diag_mat = repmat({ANB},1,N+1-i); */
    /*  diag_mat = blkdiag(diag_mat{:}); */
    i0 = 3 * i;
    i1 = 3 * i;
    loop_ub = 9 - i;
    for (y = 0; y <= loop_ub; y++) {
      b_loop_ub = -i1;
      for (i2 = 0; i2 <= b_loop_ub + 29; i2++) {
        b_Lu[i2 + (30 - i1) * y] = Lu[(i1 + i2) + 30 * y] + diag_mat_data[i2 +
          diag_mat_size[0] * y];
      }
    }

    loop_ub++;
    for (y = 0; y < loop_ub; y++) {
      b_loop_ub = 30 - i1;
      for (i2 = 0; i2 < b_loop_ub; i2++) {
        Lu[(i0 + i2) + 30 * y] = b_Lu[i2 + (30 - i1) * y];
      }
    }

    eye(11.0 - (1.0 + (real_T)i), tmp_data, tmp_size);
    b_kron(tmp_data, tmp_size, ANK, diag_mat_data, diag_mat_size);

    /*  diag_mat = repmat({ANK},1,N+1-i); */
    /*  diag_mat = blkdiag(diag_mat{:}); */
    i0 = 3 * i;
    i1 = 3 * i;
    loop_ub = 9 - i;
    for (y = 0; y <= loop_ub; y++) {
      b_loop_ub = -i1;
      for (i2 = 0; i2 <= b_loop_ub + 29; i2++) {
        b_Lu[i2 + (30 - i1) * y] = Lk[(i1 + i2) + 30 * y] + diag_mat_data[i2 +
          diag_mat_size[0] * y];
      }
    }

    loop_ub++;
    for (y = 0; y < loop_ub; y++) {
      b_loop_ub = 30 - i1;
      for (i2 = 0; i2 < b_loop_ub; i2++) {
        Lk[(i0 + i2) + 30 * y] = b_Lu[i2 + (30 - i1) * y];
      }
    }

    eye(11.0 - (1.0 + (real_T)i), tmp_data, tmp_size);
    b_kron(tmp_data, tmp_size, ANE, diag_mat_data, diag_mat_size);

    /*  diag_mat = repmat({ANE},1,N+1-i); */
    /*  diag_mat = blkdiag(diag_mat{:}); */
    i0 = 3 * i;
    i1 = 3 * i;
    loop_ub = 9 - i;
    for (y = 0; y <= loop_ub; y++) {
      b_loop_ub = -i1;
      for (i2 = 0; i2 <= b_loop_ub + 29; i2++) {
        b_Lu[i2 + (30 - i1) * y] = Ld[(i1 + i2) + 30 * y] + diag_mat_data[i2 +
          diag_mat_size[0] * y];
      }
    }

    loop_ub++;
    for (y = 0; y < loop_ub; y++) {
      b_loop_ub = 30 - i1;
      for (i2 = 0; i2 < b_loop_ub; i2++) {
        Ld[(i0 + i2) + 30 * y] = b_Lu[i2 + (30 - i1) * y];
      }
    }

    y = 3 * i + 1;
    i0 = 3 * (1 + i);
    if (y > i0) {
      i1 = 0;
      i0 = 0;
    } else {
      i1 = y - 1;
    }

    y = i0 - i1;
    loop_ub = i0 - i1;
    for (i0 = 0; i0 < loop_ub; i0++) {
      b_tmp_data[i0] = (int8_T)(i1 + i0);
    }

    for (i0 = 0; i0 < 3; i0++) {
      for (i1 = 0; i1 < y; i1++) {
        Lx[b_tmp_data[i1] + 30 * i0] = AN[i1 + 3 * i0];
      }
    }

    for (i0 = 0; i0 < 3; i0++) {
      c_dyn_A[i0] = 0.0;
      for (i1 = 0; i1 < 3; i1++) {
        c_dyn_A[i0] += dyn_A[i0 + 3 * i1] * ANB[i1];
      }
    }

    for (i0 = 0; i0 < 3; i0++) {
      ANB[i0] = c_dyn_A[i0];
      dyn_B[i0] = 0.0;
      for (i1 = 0; i1 < 3; i1++) {
        dyn_B[i0] += dyn_A[i0 + 3 * i1] * ANK[i1];
      }
    }

    for (i0 = 0; i0 < 3; i0++) {
      ANK[i0] = dyn_B[i0];
      c_dyn_A[i0] = 0.0;
      for (i1 = 0; i1 < 3; i1++) {
        c_dyn_A[i0] += dyn_A[i0 + 3 * i1] * ANE[i1];
      }
    }

    for (i0 = 0; i0 < 3; i0++) {
      ANE[i0] = c_dyn_A[i0];
      for (i1 = 0; i1 < 3; i1++) {
        b_dyn_A[i0 + 3 * i1] = 0.0;
        for (y = 0; y < 3; y++) {
          b_dyn_A[i0 + 3 * i1] += dyn_A[i0 + 3 * y] * AN[y + 3 * i1];
        }
      }
    }

    for (i0 = 0; i0 < 3; i0++) {
      for (i1 = 0; i1 < 3; i1++) {
        AN[i1 + 3 * i0] = b_dyn_A[i1 + 3 * i0];
      }
    }
  }

  sum(Lk, b_Lk);

  /* %%%%%%%%%%%%%%%%%%%%%%%%%%% */
  /* %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */
  /* %%%% Create poly constraints %%%%% */
  /* %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% */
  /*  Add input constraints */
  c_kron(dv15, *(real_T (*)[12])&dyn_XUA[0], dLU_x);

  /*  dLU_x = repmat({LU_x},1,N-1);  */
  /*  dLU_x = blkdiag(dLU_x{:}); */
  d_kron(dv15, *(real_T (*)[4])&dyn_XUA[12], dLU_u);

  /*  dLU_u = repmat({LU_u},1,N-1);  */
  /*  dLU_u = blkdiag(dLU_u{:}); */
  b_repmat(dyn_XUb, dlU);

  /*  Add state constraints, x(i) \in poly(i)(perm(i)) for all i */
  e_kron(dv14, polyA, diagA);
  c_repmat(polyb, diagb);

  /*  part of Ld acting on d(0) - only disturbance we care about */
  for (i0 = 0; i0 < 36; i0++) {
    for (i1 = 0; i1 < 3; i1++) {
      b_dLU_x[i0 + 36 * i1] = 0.0;
      for (y = 0; y < 27; y++) {
        b_dLU_x[i0 + 36 * i1] += dLU_x[i0 + 36 * y] * Lx[y + 30 * i1];
      }
    }

    for (i1 = 0; i1 < 9; i1++) {
      c_dLU_x[i0 + 36 * i1] = 0.0;
      for (y = 0; y < 27; y++) {
        c_dLU_x[i0 + 36 * i1] += dLU_x[i0 + 36 * y] * Lu[y + 30 * i1];
      }
    }
  }

  for (i0 = 0; i0 < 9; i0++) {
    memcpy(&d_dLU_x[36 * i0], &c_dLU_x[36 * i0], 36U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 36; i0++) {
    d_dLU_x[324 + i0] = 0.0;
    dv16[i0] = 0.0;
  }

  for (i0 = 0; i0 < 9; i0++) {
    memcpy(&dv16[36 * (i0 + 1)], &dLU_u[36 * i0], 36U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 290; i0++) {
    b_diagA[i0] = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      b_diagA[i0] += diagA[i0 + 290 * i1] * Ld[i1];
    }

    for (i1 = 0; i1 < 3; i1++) {
      c_diagA[i0 + 290 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        c_diagA[i0 + 290 * i1] += diagA[i0 + 290 * y] * Lx[y + 30 * i1];
      }

      h_diagA[i0 + 290 * i1] = b_diagA[i0] * dyn_XD_plus[i1];
    }

    for (i1 = 0; i1 < 10; i1++) {
      d_diagA[i0 + 290 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        d_diagA[i0 + 290 * i1] += diagA[i0 + 290 * y] * Lu[y + 30 * i1];
      }
    }

    e_diagA[i0] = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      e_diagA[i0] += diagA[i0 + 290 * i1] * Ld[i1];
    }

    for (i1 = 0; i1 < 3; i1++) {
      f_diagA[i0 + 290 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        f_diagA[i0 + 290 * i1] += diagA[i0 + 290 * y] * Lx[y + 30 * i1];
      }

      i_diagA[i0 + 290 * i1] = e_diagA[i0] * dyn_XD_minus[i1];
    }

    for (i1 = 0; i1 < 10; i1++) {
      g_diagA[i0 + 290 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        g_diagA[i0 + 290 * i1] += diagA[i0 + 290 * y] * Lu[y + 30 * i1];
      }
    }
  }

  for (i0 = 0; i0 < 3; i0++) {
    for (i1 = 0; i1 < 4; i1++) {
      HH[i1 + 620 * i0] = dyn_XUA[i1 + (i0 << 2)];
    }

    memcpy(&HH[4 + 620 * i0], &b_dLU_x[36 * i0], 36U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 4; i0++) {
    HH[1860 + i0] = dyn_XUA[12 + i0];
  }

  for (i0 = 0; i0 < 9; i0++) {
    for (i1 = 0; i1 < 4; i1++) {
      HH[i1 + 620 * (i0 + 4)] = 0.0;
    }
  }

  for (i0 = 0; i0 < 10; i0++) {
    for (i1 = 0; i1 < 36; i1++) {
      HH[(i1 + 620 * (i0 + 3)) + 4] = d_dLU_x[i1 + 36 * i0] + dv16[i1 + 36 * i0];
    }
  }

  for (i0 = 0; i0 < 3; i0++) {
    for (i1 = 0; i1 < 290; i1++) {
      HH[(i1 + 620 * i0) + 40] = c_diagA[i1 + 290 * i0] + h_diagA[i1 + 290 * i0];
    }
  }

  for (i0 = 0; i0 < 10; i0++) {
    memcpy(&HH[40 + 620 * (i0 + 3)], &d_diagA[290 * i0], 290U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 3; i0++) {
    for (i1 = 0; i1 < 290; i1++) {
      HH[(i1 + 620 * i0) + 330] = f_diagA[i1 + 290 * i0] + i_diagA[i1 + 290 * i0];
    }
  }

  for (i0 = 0; i0 < 10; i0++) {
    memcpy(&HH[330 + 620 * (i0 + 3)], &g_diagA[290 * i0], 290U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 10; i0++) {
    memcpy(&A_ineq[620 * i0], &HH[620 * (3 + i0)], 620U * sizeof(real_T));
  }

  for (i0 = 0; i0 < 36; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 27; i1++) {
      u1 += dLU_x[i0 + 36 * i1] * b_Lk[i1];
    }

    b_dlU[i0] = dlU[i0] - u1;
  }

  for (i0 = 0; i0 < 290; i0++) {
    b_diagA[i0] = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      b_diagA[i0] += diagA[i0 + 290 * i1] * Ld[i1];
    }

    e_diagA[i0] = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      e_diagA[i0] += diagA[i0 + 290 * i1] * Ld[i1];
    }
  }

  for (i0 = 0; i0 < 290; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      u1 += diagA[i0 + 290 * i1] * b_Lk[i1];
    }

    b_diagb[i0] = (diagb[i0] - u1) - b_diagA[i0] * dyn_XD_plus[3];
  }

  for (i0 = 0; i0 < 290; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      u1 += diagA[i0 + 290 * i1] * b_Lk[i1];
    }

    c_diagb[i0] = (diagb[i0] - u1) - e_diagA[i0] * dyn_XD_minus[3];
  }

  for (i0 = 0; i0 < 4; i0++) {
    b_dyn_XUb[i0] = dyn_XUb[i0];
  }

  memcpy(&b_dyn_XUb[4], &b_dlU[0], 36U * sizeof(real_T));
  memcpy(&b_dyn_XUb[40], &b_diagb[0], 290U * sizeof(real_T));
  memcpy(&b_dyn_XUb[330], &c_diagb[0], 290U * sizeof(real_T));
  for (i0 = 0; i0 < 620; i0++) {
    b_HH[i0] = 0.0;
    for (i1 = 0; i1 < 3; i1++) {
      b_HH[i0] += HH[i0 + 620 * i1] * x0[i1];
    }

    b_ineq[i0] = b_dyn_XUb[i0] - b_HH[i0];
  }

  /* %%%%%%%%%%%%%%%%%%%%%%%%%%% */
  /* %% Create QP costs %%%%%%%% */
  /* %%%%%%%%%%%%%%%%%%%%%%%%%%% */
  for (i0 = 0; i0 < 10; i0++) {
    for (i1 = 0; i1 < 30; i1++) {
      b_Lu[i0 + 10 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        b_Lu[i0 + 10 * i1] += Lu[y + 30 * i0] * Rx[y + 30 * i1];
      }
    }
  }

  for (i0 = 0; i0 < 10; i0++) {
    for (i1 = 0; i1 < 10; i1++) {
      u1 = 0.0;
      for (y = 0; y < 30; y++) {
        u1 += b_Lu[i0 + 10 * y] * Lu[y + 30 * i1];
      }

      H[i0 + 10 * i1] = Ru[i0 + 10 * i1] + u1;
    }
  }

  for (i0 = 0; i0 < 10; i0++) {
    for (i1 = 0; i1 < 30; i1++) {
      b_Lu[i0 + 10 * i1] = 0.0;
      for (y = 0; y < 30; y++) {
        b_Lu[i0 + 10 * i1] += Lu[y + 30 * i0] * Rx[y + 30 * i1];
      }
    }
  }

  for (i0 = 0; i0 < 30; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 3; i1++) {
      u1 += Lx[i0 + 30 * i1] * x0[i1];
    }

    b_Lx[i0] = u1 + b_Lk[i0];
  }

  for (i0 = 0; i0 < 10; i0++) {
    u1 = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      u1 += b_Lu[i0 + 10 * i1] * b_Lx[i1];
    }

    dv17[i0] = u1;
  }

  for (i0 = 0; i0 < 10; i0++) {
    c_Lu[i0] = 0.0;
    for (i1 = 0; i1 < 30; i1++) {
      c_Lu[i0] += Lu[i1 + 30 * i0] * rx[i1];
    }

    f[i0] = dv17[i0] + c_Lu[i0];
  }

  if (!(all_safe != 0)) {
    memset(&H[0], 0, 100U * sizeof(real_T));
    for (i = 0; i < 10; i++) {
      f[i] = 1.0;
    }
  }
}

/* End of code generation (qp_vars.c) */
